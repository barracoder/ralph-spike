# Ralph Progress Log
Started: Thu 15 Jan 2026 23:59:33 GMT
---

## Codebase Patterns
- prd.json must be an object with `branchName` at root, not a plain array
- prd.json lives in `scripts/ralph/prd.json`
- Use DotNetObjectReference + [JSInvokable] for JS-to-C# callbacks in Blazor
- Implement IAsyncDisposable to clean up JS interop resources
- Use axis-aligned bounding box (RectsIntersect) helper for simple collision detection between entities

---

## 2026-01-16T00:01 - Story 1
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented comprehensive README with project overview, install instructions, and Ralph quickstart
- Files changed: README.md, scripts/ralph/prd.json (fixed structure)
- **Learnings for future iterations:**
  - PRD was initially a plain array - fixed to object with `branchName` at root per AGENTS.md gotcha
  - Current branch is `inital-setup` (note typo in branch name)
---

## 2026-01-16T00:23 - Story 1
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created Blazor WebAssembly project with .NET 8 in src/SpaceInvaders
- Added Blazor.Extensions.Canvas package (version 1.1.1)
- Verified build and run work (dev server on localhost:5041)
- **Learnings for future iterations:**
  - Use `dotnet new blazorwasm -n NAME -f net8.0 -o OUTPUT --no-https` for simple wasm project
  - Clean obj/bin before build if getting weird MSBuild errors
  - Port is configured in Properties/launchSettings.json (5041 by default)
---

## 2026-01-16T00:25 - Story 2
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created GameCanvas.razor with 800x600 HTML5 canvas using Blazor.Extensions.Canvas
- Renders black background color with green border
- Added canvas JS interop script to index.html
- Updated Home.razor to display GameCanvas component
- Files changed: Components/GameCanvas.razor, Components/GameCanvas.razor.css, Pages/Home.razor, _Imports.razor, wwwroot/index.html
- **Learnings for future iterations:**
  - Blazor.Extensions.Canvas requires adding `_content/Blazor.Extensions.Canvas/blazor.extensions.canvas.js` to index.html
  - Use BECanvas component with Width/Height props, then CreateCanvas2DAsync() for 2D context
  - Components directory needs to be created manually and added to _Imports.razor
---

## 2026-01-16T00:27 - Story 3
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented requestAnimationFrame game loop via JS interop
- Created wwwroot/js/gameLoop.js with start/stop/tick functions
- Updated GameCanvas.razor with JSRuntime injection, DotNetObjectReference, and IAsyncDisposable
- Canvas clears and redraws each frame at ~60fps
- Files changed: Components/GameCanvas.razor, wwwroot/index.html, wwwroot/js/gameLoop.js
- **Learnings for future iterations:**
  - Use DotNetObjectReference<T> to pass C# instance to JS for callbacks
  - Mark callback methods with [JSInvokable] attribute
  - Implement IAsyncDisposable to clean up JS resources and prevent memory leaks
  - requestAnimationFrame returns an ID needed for cancelAnimationFrame
---

## 2026-01-16T00:30 - Story 4
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created Player.cs entity class in Entities directory
- Implemented keyboard.js for input handling (Arrow keys + A/D)
- Updated GameCanvas.razor with Update loop and player rendering
- Player renders as green 50x20 rectangle at bottom center
- Movement constrained to canvas bounds
- Files changed: Entities/Player.cs, wwwroot/js/keyboard.js, Components/GameCanvas.razor, wwwroot/index.html
- **Learnings for future iterations:**
  - Use async mode for dotnet run, not detached (detached can fail silently)
  - JS keyboard handler should use e.code (ArrowLeft, KeyA) not e.key
  - Prevent default on arrow keys to avoid page scrolling
  - KeyboardState class must have matching property names to JS object (Left/left case matters with default serialization)
---

## 2026-01-16T00:33 - Story 5
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented player shooting with Bullet.cs entity
- Spacebar fires white bullet upward, max 1 bullet at a time
- Bullet moves at speed -8 (upward) and disappears when off screen
- Added _spaceWasPressed flag to prevent continuous firing while holding space
- Files changed: Entities/Bullet.cs, Components/GameCanvas.razor
- **Learnings for future iterations:**
  - Use key-down tracking (_spaceWasPressed) to detect single key press vs held
  - Blazor JS interop deserialization is case-insensitive by default (leftâ†’Left works)
  - Bullet speed negative for upward movement, positive for downward
---

## 2026-01-16T00:36 - Story 6
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Created Invader.cs entity with position, size, row/column tracking
- Created 5x11 grid (55 invaders) in GameCanvas.razor
- Invaders render as white rectangles in formation at top of screen
- Files changed: Entities/Invader.cs, Components/GameCanvas.razor
- **Learnings for future iterations:**
  - Invader spacing: 50px horizontal, 40px vertical, starting at (60, 60)
  - Use List<Invader> with IsAlive property for future destruction
  - Grid initialization should happen after canvas context is ready
---

## 2026-01-16T00:39 - Story 7
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented invader movement: all invaders move horizontally together
- Edge detection reverses direction and drops invaders down one row
- Added Move() method to Invader.cs for position updates
- Files changed: Entities/Invader.cs, Components/GameCanvas.razor
- **Learnings for future iterations:**
  - Use LINQ .Where(i => i.IsAlive) to filter active invaders for movement
  - Check all alive invaders for edge collision before moving any
  - Separate drop logic from horizontal move (drop first, then reverse)
  - InvaderSpeed 1.5f and DropAmount 20f work well at 60fps
---
## 2026-01-16T00:43:59.770Z - 8
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented invader shooting: enemy bullets fire periodically from bottom-row invaders and move downward.
- Files changed:
  - src/SpaceInvaders/Components/GameCanvas.razor
  - src/SpaceInvaders/Entities/Bullet.cs
  - scripts/verify-ui.mjs
  - scripts/ralph/prd.json
- **Learnings for future iterations:**
  - Bottom-row invader selection groups by column; use highest Y per column to pick shooter.
  - Bullet.Speed > 0 moves downward; use positive speed for enemy bullets and negative for player bullets.
---
## 2026-01-16T00:47:22.625Z - 9
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented
  - Implemented collision detection: player bullets destroy invaders; enemy bullets damage player and reduce lives.
- Files changed
  - src/SpaceInvaders/Components/GameCanvas.razor
  - scripts/ralph/prd.json
  - scripts/ralph/progress.txt
  - AGENTS.md
- **Learnings for future iterations:**
  - Patterns discovered: Use axis-aligned bounding box (RectsIntersect) for simple collision detection between rectangular entities.
  - Gotchas encountered: Ensure collision checks run after position updates for bullets and invaders to avoid missed collisions.
  - Useful context: _lives field added to GameCanvas for tracking player health; GameState and ScoreDisplay should be integrated in later stories.
---

## 2026-01-16T00:51:30.145Z - 10
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented
  - Added Shield entity and integrated destructible shields into GameCanvas; shields absorb bullets and degrade on impact.
- Files changed
  - src/SpaceInvaders/Entities/Shield.cs
  - src/SpaceInvaders/Components/GameCanvas.razor
  - scripts/ralph/prd.json
- **Learnings for future iterations:**
  - Patterns discovered: Place shields as entities with HP; check shield collisions before invaders/player so they absorb bullets first.
  - Gotchas encountered: Removing bullets while iterating requires reverse loops or collection copies; render order matters.
  - Useful context: Shields default to 3 HP and are placed evenly between player and invaders.
---
## 2026-01-16T00:55:11Z - Story 11
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented
  - ScoreDisplay.razor component showing Score, High Score, and Lives; wired to GameCanvas and updated in real-time.
- Files changed
  - src/SpaceInvaders/Components/ScoreDisplay.razor
  - src/SpaceInvaders/Components/GameCanvas.razor
  - scripts/ralph/prd.json
- **Learnings for future iterations:**
  - Score and lives are stored in GameCanvas; consider extracting to GameState service for cross-component access.
  - Remember to call StateHasChanged after canvas render loop updates so Blazor markup updates.
  - Keep score increment values centralized for easier tuning.
---

## 2026-01-16T00:58:28Z - 12
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented
  - Implemented GameStateService (Start, Playing, GameOver)
  - Added StartScreen.razor and GameOverScreen.razor and wired GameCanvas to use GameStateService
- Files changed
  - src/SpaceInvaders/Entities/GameState.cs
  - src/SpaceInvaders/Components/StartScreen.razor
  - src/SpaceInvaders/Components/GameOverScreen.razor
  - src/SpaceInvaders/Components/GameCanvas.razor
  - src/SpaceInvaders/Program.cs
  - scripts/ralph/prd.json
- **Learnings for future iterations:**
  - Use GameStateService singleton to coordinate UI/screens and game loop.
  - Stop game updates by early-returning in Update() when in Start or GameOver state.
  - Remember to register services in Program.cs for DI.
---

## 2026-01-16T01:01:47.556Z - Story 13
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented
  - Implemented wave progression: new wave spawns when all invaders are destroyed, invader speed increases each wave, and wave number tracked and displayed.
- Files changed
  - src/SpaceInvaders/Components/GameCanvas.razor
  - src/SpaceInvaders/Components/ScoreDisplay.razor
  - scripts/ralph/prd.json
- **Learnings for future iterations:**
  - Patterns discovered: Increase invader speed per wave using a mutable _invaderSpeed field; reinitialize invaders and clear enemy bullets when starting new wave.
  - Gotchas encountered: Ensure invader movement speed is a variable (not const) so it can be tuned per wave; reset invaderDirection to avoid immediate edge drop on new wave.
  - Useful context: Wave counter exposed to ScoreDisplay for easy UI display.
---

